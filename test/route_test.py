# -*- coding: utf-8 -*-
"""
Created on Sun Jan 19 18:11:27 2020

@author: arthurd
"""


import numpy as np
import osmnx as ox
from noiseplanet.matching.model import route

# Visualize the data
import matplotlib.pyplot as plt

track = np.array( [[45.75808652,  4.83560179],
                   [45.75808072,  4.83559897],
                   [45.75807154,  4.83559451],
                   [45.75806118,  4.83558948],
                   [45.7580448 ,  4.83558152],
                   [45.75804304,  4.83558066],
                   [45.75804304,  4.83558066],
                   [45.75802703,  4.83557288],
                   [45.75801895,  4.83556895],
                   [45.75801895,  4.83556895],
                   [45.75800954,  4.83556438],
                   [45.75800681,  4.83556305],
                   [45.75800681,  4.83556305],
                   [45.75800209,  4.83556075],
                   [45.75798288,  4.83555142],
                   [45.75797578,  4.83554797],
                   [45.75797578,  4.83554797],
                   [45.75796259,  4.83554155],
                   [45.7579395 ,  4.83553033],
                   [45.7579395 ,  4.83553033],
                   [45.7579401 ,  4.83553062],
                   [45.75792429,  4.83552294],
                   [45.75792505,  4.83552331],
                   [45.75792505,  4.83552331],
                   [45.7579092 ,  4.83551561],
                   [45.75787935,  4.83550109],
                   [45.75787935,  4.83550109],
                   [45.75786135,  4.83549235],
                   [45.75783387,  4.83547899],
                   [45.75783387,  4.83547899],
                   [45.75782827,  4.83547626],
                   [45.75780555,  4.83546522],
                   [45.7577986 ,  4.83546184],
                   [45.7577986 ,  4.83546184],
                   [45.75778285,  4.83545419],
                   [45.75777404,  4.8354499 ],
                   [45.75777404,  4.8354499 ],
                   [45.75777062,  4.83544824],
                   [45.75776757,  4.83544676],
                   [45.75776757,  4.83544676],
                   [45.7576868 ,  4.8354075 ],
                   [45.7576868 ,  4.8354075 ],
                   [45.7576868 ,  4.8354075 ],
                   [45.7576868 ,  4.8354075 ],
                   [45.7576868 ,  4.8354075 ],
                   [45.7576868 ,  4.8354075 ],
                   [45.7576868 ,  4.8354075 ],
                   [45.7576868 ,  4.8354075 ],
                   [45.7576661 ,  4.8353975 ],
                   [45.7576602 ,  4.8353946 ],
                   [45.757616  ,  4.8353727 ],
                   [45.7576184 ,  4.8352258 ],
                   [45.7576184 ,  4.8352258 ],
                   [45.7576184 ,  4.8352258 ],
                   [45.7576184 ,  4.8352258 ],
                   [45.7576271 ,  4.83519347],
                   [45.7576271 ,  4.83519347],
                   [45.75763509,  4.8351638 ],
                   [45.75763647,  4.83515865],
                   [45.7576435 ,  4.83513256],
                   [45.7576435 ,  4.83513256],
                   [45.75766249,  4.83506198],
                   [45.75767896,  4.83500081],
                   [45.7576857 ,  4.83497574],
                   [45.75773198,  4.83490256],
                   [45.75771533,  4.8348978 ],
                   [45.75771533,  4.8348978 ],
                   [45.7577073 ,  4.8348955 ],
                   [45.7576796 ,  4.8348876 ],
                   [45.75768915,  4.83485389],
                   [45.75768915,  4.83485389],
                   [45.75769217,  4.83484327],
                   [45.75769951,  4.83481735],
                   [45.75770616,  4.83479389],
                   [45.75771686,  4.83475614],
                   [45.7577276 ,  4.83471826],
                   [45.7577276 ,  4.83471826],
                   [45.75773842,  4.83468007],
                   [45.75775038,  4.83463789],
                   [45.75775809,  4.83461068],
                   [45.75775809,  4.83461068]])

graph = route.graph_from_track(track)
route, edge_id, stats = route.route_from_track(graph, track, states=None)


# Visualization leuven - Leuven Map Matching
fig, ax = ox.plot_graph(graph, node_color="skyblue", node_alpha=.5, node_size=15, show=False, close=False, annotate=False)
plt.title("Map Matching with Viterbi's algorithm (leuven)", color="#999999")
plt.scatter(track[:, 1], track[:, 0], s=30, marker='.', color="darkcyan", zorder=2, label='Original Point')
plt.plot(route[:, 1], route[:, 0], linewidth=2, alpha=.7, color="darkcyan")
